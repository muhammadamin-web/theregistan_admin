import{r as h,w as t,t as R,B as P,D as E,z as k,E as V,F as W,S as z,H as G,I as O,O as Z,K as x,P as U,M as w,Q as K}from"./index-686e0b19.js";import{U as Q}from"./LoadingRefresh-b9dcae7d.js";import{U as X}from"./UniversalBody-ff1f50f0.js";import{b as q,I as J,a as Y}from"./index-5848e3fb.js";import{p as D}from"./ImageCompressor-ef630e5a.js";import{W as ee}from"./WarningPopUp-55c4bd53.js";import{e as te}from"./empty-image-a9a8b5d3.js";import{T as ae}from"./Thead-c7662f3d.js";let b;const se=new Uint8Array(16);function oe(){if(!b&&(b=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!b))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return b(se)}const r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));function ne(e,a=0){return r[e[a+0]]+r[e[a+1]]+r[e[a+2]]+r[e[a+3]]+"-"+r[e[a+4]]+r[e[a+5]]+"-"+r[e[a+6]]+r[e[a+7]]+"-"+r[e[a+8]]+r[e[a+9]]+"-"+r[e[a+10]]+r[e[a+11]]+r[e[a+12]]+r[e[a+13]]+r[e[a+14]]+r[e[a+15]]}const re=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:re};function ce(e,a,m){if(F.randomUUID&&!a&&!e)return F.randomUUID();e=e||{};const i=e.random||(e.rng||oe)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,a){m=m||0;for(let c=0;c<16;++c)a[m+c]=i[c];return a}return ne(i)}function A({setPopUp:e,infos:a,submitFunc:m,setBody:i,body:c,setImgData:l,imgUrl:d,setImgUrl:u}){const p=h.useRef();return t.jsx("div",{id:"popUp_bg",className:"category_popUp",onClick:n=>{n.target.id=="popUp_bg"&&(e(!1),i({}),l(),u(""))},children:t.jsxs("form",{children:[t.jsx("div",{className:"close_btn",onClick:()=>{e(!1),i({}),l(),u("")},children:t.jsx(q,{})}),t.jsxs("div",{className:"form_div",children:[t.jsx("input",{ref:p,className:"input_img",id:"categoryImage",type:"file",accept:"image/*",onChange:n=>{D(n,u,l)}}),t.jsxs("label",{style:d?{cursor:"auto"}:{cursor:"pointer"},htmlFor:d?"":"categoryImage",children:[!d&&t.jsxs(t.Fragment,{children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"190",height:"160",viewBox:"0 0 190 160",fill:"none",children:t.jsx("path",{d:"M55.4167 139.873C44.6029 139.174 34.328 135.616 26.059 129.706C17.79 123.796 11.9498 115.837 9.37223 106.966C6.7947 98.0942 7.61166 88.7637 11.7064 80.3065C15.8012 71.8493 22.9645 64.6979 32.1734 59.8733C34.1328 47.0072 41.5926 35.1833 53.1566 26.6144C64.7207 18.0454 79.5964 13.3186 95 13.3186C110.404 13.3186 125.279 18.0454 136.843 26.6144C148.407 35.1833 155.867 47.0072 157.827 59.8733C167.036 64.6979 174.199 71.8493 178.294 80.3065C182.388 88.7637 183.205 98.0942 180.628 106.966C178.05 115.837 172.21 123.796 163.941 129.706C155.672 135.616 145.397 139.174 134.583 139.873V140H55.4167V139.873ZM102.917 86.6667H126.667L95 53.3333L63.3334 86.6667H87.0834V113.333H102.917V86.6667Z",fill:"#1E77CC"})}),"Browse Photo to upload"]}),d&&t.jsx("img",{src:d})]})]}),t.jsx("div",{className:"span_div",children:t.jsx("span",{onClick:()=>{d?(u(""),l()):p.current.click()},children:d?"Delete Photo":"Upload Photo"})}),t.jsx("div",{className:"name_div",children:t.jsx("input",{onInput:n=>{i({...c,name:n.target.value})},value:c.name||"",type:"text",placeholder:"Category Name..."})}),t.jsx("button",{onClick:n=>{n.preventDefault(),m()},children:a.finalBtn})]})})}function ie({singleData:e,setEditPopUp:a,setBody:m,setImgUrl:i}){var l,d;const c=R();return t.jsxs("tr",{className:"category-tr",children:[t.jsx("td",{children:t.jsx("div",{className:"main__table-text",children:t.jsx("img",{src:(l=e==null?void 0:e.image)!=null&&l.name?`${P+((d=e==null?void 0:e.image)==null?void 0:d.name)}`:te})})}),t.jsx("td",{children:t.jsx("div",{className:"main__table-text",children:t.jsx("a",{children:e.name})})}),t.jsx("td",{children:t.jsxs("div",{className:"main__table-text",children:[t.jsx("a",{className:"main__table-btn main__table-edit",onClick:()=>{var u,p,n;a(!0),m({name:e.name}),c(E(e._id)),c(k((u=e==null?void 0:e.image)==null?void 0:u._id)),i((p=e==null?void 0:e.image)!=null&&p.name?P+((n=e==null?void 0:e.image)==null?void 0:n.name):"")},children:t.jsx(J,{})}),t.jsx("a",{className:"main__table-btn main__table-trash",onClick:()=>{c(E(e._id)),c(V(!0))},children:t.jsx(Y,{})})]})})]})}const de={type:"delete this category",warning:"This may cause some error!"},me=["IMAGE","name","ACTIONS"],le={title:"Category",btn:"Add Category",link:""},T={addData:{btntext:"Upload Photo",finalBtn:"Add"},editData:{btntext:"Change Photo",finalBtn:"Change"}};function Ce(){const e=R(),{categories:a,warningPopUp:m,currentId:i,currentImgId:c}=W(s=>s.home),[l,d]=h.useState(!1),[u,p]=h.useState(!1),[n,g]=h.useState({}),[$,y]=h.useState(!1),[N,v]=h.useState({status:"",message:""}),[j,f]=h.useState(),[C,_]=h.useState(""),I=()=>{O("/category").then(s=>{e(Z(s.data)),e(x(!1))})},B=()=>{d(!1),e(x(!0)),U("/image/upload",j).then(s=>{const o=j?{...n,image:s.data._id}:{...n};return U("/category",o)}).then(s=>{var o;s.success?I():(v({status:s==null?void 0:s.status,message:(o=s==null?void 0:s.data)==null?void 0:o.message}),e(x(!1)),y(!0),setTimeout(()=>{y(!1)},5e3))}).finally(()=>{g({}),f(""),_("")})},H=async()=>{var s;try{p(!1),e(x(!0));const o=!!j,S=!!c;C&&o&&S?await w(`/image/${c}`):!C&&S&&await w(`/image/${c}`);const L=o?{...n,image:(await U("/image/upload",j)).data._id}:n;await K(`/category/${i}`,L),I()}catch(o){v({status:o.status,message:(s=o.data)==null?void 0:s.message}),e(x(!1)),y(!0)}finally{g({}),f(""),e(k(""))}},M=async()=>{var s;e(V(!1)),e(x(!0));try{const o=await w(`/category/${i}`);o.success?I():(v({status:o==null?void 0:o.status,message:(s=o==null?void 0:o.data)==null?void 0:s.message}),y(!0),setTimeout(()=>y(!1),3e3))}finally{e(x(!1))}};return h.useEffect(()=>{I()},[]),t.jsxs("div",{className:"category_section",children:[t.jsx(Q,{setPopUp:d,data:le}),t.jsxs(X,{children:[t.jsxs("div",{className:"category_body",children:[t.jsxs("table",{children:[t.jsx(ae,{theadDatas:me}),t.jsx("tbody",{children:a.map(s=>t.jsx(ie,{setEditPopUp:p,setBody:g,setImgUrl:_,singleData:s},ce()))})]}),$&&t.jsx(z,{direction:"vertical",style:{minWidth:"25%",position:"fixed",zIndex:"0",left:"50%",transform:"translateX(-40%)",top:"1%"},children:t.jsx(G,{message:`Error Code ${N.status}`,description:`${N.message}`,type:"error",showIcon:!0,closable:!0,onClose:()=>{y(!1)}})})]}),l&&t.jsx(A,{setImgUrl:_,imgUrl:C,setPopUp:d,infos:T.addData,setBody:g,body:n,submitFunc:B,setImgData:f}),u&&t.jsx(A,{setImgUrl:_,imgUrl:C,submitFunc:H,setPopUp:p,infos:T.editData,setBody:g,body:n,setImgData:f})]}),m&&t.jsx(ee,{warningDatas:de,deleteItem:M})]})}export{Ce as default};
